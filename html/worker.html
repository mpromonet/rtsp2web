<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" type="image/png" href="favicon.png">
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>    
    <body>
        <div id="content">
            <video id="video" muted playsinline controls preload="none"></video>
        </div>
        <footer>
                <a href="https://github.com/mpromonet/rtsp2ws">rtsp2ws</a>
                <div id="version"></div>
        </footer>
    </body>

    <script>    
        fetch("/api/version").then(r => r.json()).then(r => version.innerText = r);

        const canvas = document.createElement("canvas");
        video.srcObject = canvas.captureStream();
        video.play();
        const offscreenCanvas = canvas.transferControlToOffscreen();
        
        const worker = new Worker('worker.js');        
        worker.postMessage({ canvas: offscreenCanvas, url: location.search.slice(1) || "/ws0" }, [offscreenCanvas]);

        window.onbeforeunload = () => worker.terminate();
    </script>        
</html>
